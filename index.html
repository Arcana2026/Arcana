<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcana Safe | Sanctuaire Web3</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@web3-onboard/core@2.21.2/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@web3-onboard/injected-wallets@2.10.11/dist/index.min.js"></script>

    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #F7E7CE;
            --bg-dark: #05070a;
            --glass: rgba(255, 255, 255, 0.03);
        }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(212, 175, 55, 0.07) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 255, 204, 0.04) 0%, transparent 40%);
            color: var(--gold-light);
            font-family: 'Inter', sans-serif;
            margin: 0;
            min-height: 100vh;
        }

        .font-luxury { font-family: 'Cinzel', serif; }

        .nav-blur {
            background: rgba(5, 7, 10, 0.85);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 28px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        }

        .btn-premium {
            background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);
            color: #05070a;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
        }

        .progress-track {
            background: rgba(255,255,255,0.05);
            height: 12px;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        .progress-glow {
            background: linear-gradient(90deg, #D4AF37, #00ffcc);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
            height: 100%;
            width: 2.5%;
        }

        input, select {
            background: rgba(255,255,255,0.05) !important;
            border: 1px solid rgba(212, 175, 55, 0.2) !important;
            color: white !important;
        }

        /* Quick Pouch Styles */
        #quickPouch {
            display: none;
            animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>

    <audio id="successSound" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

    <nav class="nav-blur sticky top-0 z-50 px-8 py-3 flex justify-between items-center">
        <div class="flex items-center gap-6">
            <div class="w-24 h-24 flex-shrink-0 overflow-hidden">
                <img src="logo.png" alt="Arcana" class="w-full h-full object-contain scale-150">
            </div>
            <span class="font-luxury text-2xl tracking-[0.2em] text-white">ARCANA SAFE</span>
        </div>
        <button id="connectBtn" class="px-6 py-2 border border-[#D4AF37] rounded-full text-[10px] font-bold tracking-widest hover:bg-[#D4AF37] hover:text-black transition-all">
            CONNECTER WALLET
        </button>
    </nav>

    <main class="container mx-auto px-4 py-12 max-w-5xl">
        
        <div class="text-center mb-16">
            <div class="inline-block px-4 py-1 rounded-full bg-[#D4AF37]/10 border border-[#D4AF37]/20 text-[#D4AF37] text-[10px] font-bold tracking-[0.2em] mb-6 uppercase">
                Domaine Web3 Officiel : arcana-safe.nft
            </div>
            <h1 class="text-5xl md:text-7xl font-luxury text-white mb-6 leading-tight">Le Sanctuaire de vos <br><span class="text-[#D4AF37]">Actifs Numériques</span></h1>
        </div>

        <div class="glass-card p-8 md:p-12 mb-8">
            <div class="grid md:grid-cols-2 gap-16 items-center">
                
                <div>
                    <h2 id="balanceTitle" class="text-[10px] uppercase tracking-[0.4em] text-[#D4AF37] mb-4 font-bold opacity-70">Réserve du Coffre</h2>
                    <div class="flex items-baseline gap-4 mb-10">
                        <span id="balanceDisplay" class="text-7xl font-bold text-white tracking-tighter">0.00</span>
                        <span class="text-xl text-[#D4AF37] font-luxury">ARCANA</span>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between text-[10px] mb-3 uppercase tracking-widest opacity-50 font-bold">
                                <span>Objectif : 100,000 $</span>
                                <span id="progressText">Récolté : 2,500 $</span>
                            </div>
                            <div class="progress-track">
                                <div id="progressBar" class="progress-glow"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white/5 p-8 rounded-[32px] border border-white/10 space-y-6">
                    <div class="space-y-2">
                        <label class="text-[10px] uppercase tracking-widest opacity-40">Devise d'investissement (Polygon Network)</label>
                        <select id="tokenSelect" class="w-full rounded-2xl p-4 text-sm focus:outline-none">
                            <option value="POL">Polygon (POL)</option>
                            <option value="USDT">Tether (USDT)</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] uppercase tracking-widest opacity-40">Montant</label>
                        <input type="number" id="amountInput" placeholder="0.00" class="w-full rounded-2xl p-4 text-2xl font-semibold focus:outline-none">
                    </div>

                    <div id="receiveText" class="text-center text-[10px] text-[#00ffcc] font-bold tracking-widest uppercase py-2">
                        Tu recevras : 0 ARCANA
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4">
                        <button id="buyBtn" class="btn-premium flex-1 py-5 rounded-2xl text-sm shadow-2xl">Acheter</button>
                        <a href="whitepaper.pdf" target="_blank" class="flex-1 py-5 rounded-2xl text-[10px] font-bold tracking-[0.2em] border-2 border-[#D4AF37] text-white hover:bg-[#D4AF37]/10 flex items-center justify-center">
                            WHITE PAPER
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <section class="mt-16 mb-12">
            <h2 class="font-luxury text-2xl text-center text-[#D4AF37] mb-10 tracking-[0.15em] uppercase">Guide de Poche</h2>
            <div class="grid md:grid-cols-3 gap-8 text-center">
                <div class="glass-card p-8">
                    <div class="text-[#D4AF37] text-2xl mb-4 font-luxury">01</div>
                    <h3 class="font-luxury text-white mb-2">Connecter</h3>
                    <p class="text-sm opacity-60">Utilisez votre Trust Wallet ou MetaMask sur Polygon.</p>
                </div>
                <div class="glass-card p-8">
                    <div class="text-[#D4AF37] text-2xl mb-4 font-luxury">02</div>
                    <h3 class="font-luxury text-white mb-2">Investir</h3>
                    <p class="text-sm opacity-60">Convertissez vos POL en ARCANA instantanément.</p>
                </div>
                <div class="glass-card p-8">
                    <div class="text-[#D4AF37] text-2xl mb-4 font-luxury">03</div>
                    <h3 class="font-luxury text-white mb-2">Sécuriser</h3>
                    <p class="text-sm opacity-60">Vos jetons sont protégés dans le coffre intelligent.</p>
                </div>
            </div>
        </section>
    </main>

    <div id="quickPouch" class="fixed bottom-6 right-6 z-[100]">
        <div class="glass-card p-5 flex flex-col items-center gap-3 border-[#D4AF37]/40 shadow-[0_0_30px_rgba(212,175,55,0.2)]">
            <div class="text-[10px] uppercase tracking-widest font-bold text-[#D4AF37]">Ma Réserve Arcana</div>
            <div id="pouchBalance" class="text-2xl font-bold text-white">0 ARCANA</div>
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 bg-[#00ffcc] rounded-full animate-pulse"></span>
                <span class="text-[8px] text-[#00ffcc] font-bold">POLYGON CONNECTÉ</span>
            </div>
        </div>
    </div>

    <script type="module">
        const injected = window.web3onboardInjectedWallets.default();
        
        const onboard = window.web3onboardCore.default({
            wallets: [injected],
            chains: [{ 
                id: '0x89', 
                token: 'POL', 
                label: 'Polygon Mainnet', 
                rpcUrl: 'https://polygon-rpc.com' 
            }],
            appMetadata: { 
                name: 'Arcana Safe', 
                icon: 'logo.png', 
                description: 'DeFi Sanctuary' 
            },
            accountCenter: { desktop: { enabled: true }, mobile: { enabled: true } }
        });

        const PRESALE_VAULT = "0x1990fd46a1ad0344751be45d6779b8c1f827076d";
        const abiSimple = ["function balanceOf(address owner) view returns (uint256)", "function buyWithPOL() payable"];
        
        let userAddress = null;
        let connectedSigner = null;

        async function updateUI() {
            if (userAddress && connectedSigner) {
                try {
                    const contract = new ethers.Contract(PRESALE_VAULT, abiSimple, connectedSigner);
                    const balance = await contract.balanceOf(userAddress);
                    const formatted = parseFloat(ethers.utils.formatUnits(balance, 18)).toLocaleString('fr-FR');
                    
                    document.getElementById('balanceDisplay').innerText = formatted;
                    document.getElementById('pouchBalance').innerText = formatted + " ARCANA";
                    document.getElementById('quickPouch').style.display = 'block';
                    document.getElementById('balanceTitle').innerText = "VOTRE RÉSERVE PRIVÉE";
                } catch (e) { console.error("Update UI Error:", e); }
            }
        }

        async function connect() {
            const wallets = await onboard.connectWallet();
            if (wallets[0]) {
                const provider = new ethers.providers.Web3Provider(wallets[0].provider);
                connectedSigner = provider.getSigner();
                userAddress = await connectedSigner.getAddress();
                
                // Update Button Label
                document.getElementById('connectBtn').innerText = userAddress.substring(0, 6) + "..." + userAddress.substring(38);
                document.getElementById('connectBtn').classList.add('bg-[#D4AF37]', 'text-black');
                
                updateUI();
            }
        }

        async function buyNow() {
            if (!userAddress) return await connect();
            const amount = document.getElementById('amountInput').value;
            if (!amount || amount <= 0) return alert("Veuillez entrer un montant.");
            
            const contract = new ethers.Contract(PRESALE_VAULT, abiSimple, connectedSigner);
            try {
                document.getElementById('buyBtn').innerText = "Vérification...";
                const tx = await contract.buyWithPOL({ 
                    value: ethers.utils.parseEther(amount.toString()) 
                });
                document.getElementById('buyBtn').innerText = "En cours...";
                await tx.wait();
                document.getElementById('successSound').play();
                alert("Félicitations ! Vos ARCANA ont été sécurisés dans votre coffre.");
                updateUI();
            } catch (e) { 
                console.error(e);
                alert("Transaction annulée."); 
            } finally { 
                document.getElementById('buyBtn').innerText = "Acheter"; 
            }
        }

        function calculateReceive() {
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            const receive = Math.floor(amount * 4000); 
            document.getElementById('receiveText').innerText = `Tu recevras : ${receive.toLocaleString('fr-FR')} ARCANA`;
        }

        // Event Listeners
        document.getElementById('connectBtn').addEventListener('click', connect);
        document.getElementById('buyBtn').addEventListener('click', buyNow);
        document.getElementById('amountInput').addEventListener('input', calculateReceive);
    </script>
</body>
</html>