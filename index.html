<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Arcana | Decentralized Casino</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-pink: #ff0077; --neon-blue: #00f2ff; --neon-gold: #ffcc00; --bg-dark: #050505; }
        body { background: var(--bg-dark); color: #fff; font-family: 'Orbitron', sans-serif; margin: 0; padding: 0; }
        .header { padding: 30px; text-align: center; border-bottom: 1px solid #222; }
        .container { max-width: 900px; margin: auto; padding: 20px; }
        
        /* Grille des Jeux */
        .game-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
        
        .game-card { background: #111; border: 1px solid #333; border-radius: 15px; padding: 20px; text-align: center; transition: 0.3s; position: relative; overflow: hidden; }
        .game-card.active { border-color: var(--neon-blue); box-shadow: 0 0 15px var(--neon-blue); cursor: pointer; }
        .game-card.active:hover { transform: translateY(-5px); border-color: var(--neon-pink); }
        .game-card.locked { opacity: 0.6; grayscale(1); }
        
        .badge { position: absolute; top: 10px; right: 10px; font-size: 10px; padding: 5px 10px; border-radius: 5px; }
        .badge-live { background: var(--neon-pink); color: white; }
        .badge-soon { background: #555; color: #aaa; }

        .jackpot-banner { background: rgba(255, 204, 0, 0.1); border: 1px solid var(--neon-gold); border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center; }
        .jackpot-val { font-size: 28px; color: var(--neon-gold); text-shadow: 0 0 10px var(--neon-gold); }
        
        .btn { background: transparent; border: 2px solid var(--neon-pink); color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; font-family: 'Orbitron'; }
        .status-bar { font-size: 12px; color: var(--neon-blue); margin-top: 20px; text-align: center; padding: 10px; background: #000; border-radius: 5px; }
    </style>
</head>
<body>

<div class="header">
    <h1 style="color:var(--neon-pink); margin:0;">BLOCK ARCANA</h1>
    <p style="font-size:12px; color:#666;">WEB3 DECENTRALIZED GAMING</p>
</div>

<div class="container">
    <div class="jackpot-banner">
        <div style="font-size:12px;">GLOBAL JACKPOT POOL</div>
        <div class="jackpot-val" id="jackpotValue">0.0000 POL</div>
    </div>

    <div id="status" class="status-bar">CONNEXION AU RÉSEAU...</div>

    <div class="game-grid">
        <div class="game-card active">
            <span class="badge badge-live">EN DIRECT</span>
            <h3>ULTIMATE 777</h3>
            <p style="font-size:11px; color:#aaa;">Misez et tentez de décrocher le Jackpot global.</p>
            <input type="number" id="betAmount" value="0.05" step="0.01" style="width:70%; background:black; color:white; border:1px solid #333; padding:5px; text-align:center; border-radius:5px;">
            <button class="btn" onclick="play()">JOUER</button>
        </div>

        <div class="game-card locked">
            <span class="badge badge-soon">BIENTÔT</span>
            <h3>NEON SLOTS</h3>
            <p style="font-size:11px;">Machine à sous classique 3-rouleaux.</p>
            <button class="btn" disabled style="border-color:#444; color:#444;">VERROUILLÉ</button>
        </div>

        <div class="game-card locked">
            <span class="badge badge-soon">BIENTÔT</span>
            <h3>CRYPTO POKER</h3>
            <p style="font-size:11px;">Affrontez la blockchain en duel.</p>
            <button class="btn" disabled style="border-color:#444; color:#444;">VERROUILLÉ</button>
        </div>
    </div>

    <div style="margin-top:40px; text-align:center;">
        <p style="font-size:10px; color:#444;">Votre adresse : <span id="userAddr">Déconnecté</span></p>
        <button id="adminBtn" class="btn" style="display:none; border-color:var(--neon-gold); color:var(--neon-gold); width:auto;" onclick="withdraw()">RETOUR ADMIN</button>
    </div>
</div>

<script>
    const contractAddress = "0x12CCdECfd700F5Acb2a6E24ee7173B68c398d257"; 
    const abi = [
        {"inputs":[],"name":"bet","outputs":[],"stateMutability":"payable","type":"function"},
        {"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},
        {"inputs":[],"name":"jackpot","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
        {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"}
    ];

    let signer, contract;

    async function init() {
        if (window.ethereum) {
            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                contract = new ethers.Contract(contractAddress, abi, signer);
                
                const addr = await signer.getAddress();
                document.getElementById('userAddr').innerText = addr.substring(0,6) + "..." + addr.substring(38);
                
                const owner = await contract.owner();
                if(addr.toLowerCase() === owner.toLowerCase()) document.getElementById('adminBtn').style.display = 'inline-block';
                
                document.getElementById('status').innerText = "SYSTÈME OPÉRATIONNEL - POLYGON AMOY";
                updateStats();
                setInterval(updateStats, 8000);
            } catch (e) { document.getElementById('status').innerText = "VEUILLEZ CONNECTER METAMASK"; }
        }
    }

    async function updateStats() {
        try {
            const jp = await contract.jackpot();
            document.getElementById('jackpotValue').innerText = ethers.utils.formatEther(jp) + " POL";
        } catch (e) { console.log("Erreur lecture stats"); }
    }

    async function play() {
        const amount = document.getElementById('betAmount').value;
        try {
            document.getElementById('status').innerText = "TRANSACTION EN COURS...";
            const tx = await contract.bet({ value: ethers.utils.parseEther(amount), gasLimit: 150000 });
            await tx.wait();
            document.getElementById('status').innerText = "RÉSULTAT ENREGISTRÉ !";
            updateStats();
        } catch (e) { 
            document.getElementById('status').innerText = "ERREUR OU ANNULATION";
        }
    }

    async function withdraw() {
        try {
            const tx = await contract.withdraw();
            await tx.wait();
            alert("Profits transférés vers votre wallet.");
            updateStats();
        } catch (e) { alert("Accès refusé"); }
    }

    window.onload = init;
</script>
</body>
</html>

