<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcana Safe | Sanctuaire Web3</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <!-- Web3Onboard chargé via import() dans le script principal -->

    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #F7E7CE;
            --bg-dark: #05070a;
            --glass: rgba(255, 255, 255, 0.03);
        }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(212, 175, 55, 0.07) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 255, 204, 0.04) 0%, transparent 40%);
            color: var(--gold-light);
            font-family: 'Inter', sans-serif;
            margin: 0;
            min-height: 100vh;
        }

        .font-luxury { font-family: 'Cinzel', serif; }

        .nav-blur {
            background: rgba(5, 7, 10, 0.85);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 28px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        }

        .btn-premium {
            background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);
            color: #05070a;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
        }

        .progress-track {
            background: rgba(255,255,255,0.05);
            height: 12px;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        .progress-glow {
            background: linear-gradient(90deg, #D4AF37, #00ffcc);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
            height: 100%;
            width: 2.5%;
        }

        input, select {
            background: rgba(255,255,255,0.05) !important;
            border: 1px solid rgba(212, 175, 55, 0.2) !important;
            color: white !important;
        }

        /* Quick Pouch Styles */
        #quickPouch {
            display: none;
            animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>

    <audio id="successSound" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

    <nav class="nav-blur sticky top-0 z-50 px-8 py-3 flex justify-between items-center">
        <div class="flex items-center gap-6">
            <div class="w-36 h-36 flex-shrink-0 rounded-full overflow-hidden border-2 border-[#D4AF37]/40 shadow-[0_0_25px_rgba(212,175,55,0.2)] flex items-center justify-center bg-[#05070a]">
                <img src="logo.png" alt="Arcana" class="w-full h-full object-cover scale-125">
            </div>
            <span class="font-luxury text-2xl tracking-[0.2em] text-white">ARCANA SAFE</span>
        </div>
        <button id="connectBtn" class="px-6 py-2 border border-[#D4AF37] rounded-full text-[10px] font-bold tracking-widest hover:bg-[#D4AF37] hover:text-black transition-all">
            CONNECTER WALLET
        </button>
    </nav>

    <main class="container mx-auto px-4 py-12 max-w-5xl">
        
        <div class="text-center mb-16">
            <div class="inline-block px-4 py-1 rounded-full bg-[#D4AF37]/10 border border-[#D4AF37]/20 text-[#D4AF37] text-[10px] font-bold tracking-[0.2em] mb-6 uppercase">
                Domaine Web3 Officiel : arcana-safe.nft
            </div>
            <h1 class="text-5xl md:text-7xl font-luxury text-white mb-6 leading-tight">Le Sanctuaire de vos <br><span class="text-[#D4AF37]">Actifs Numériques</span></h1>
        </div>

        <div class="glass-card p-8 md:p-12 mb-8">
            <div class="grid md:grid-cols-2 gap-16 items-center">
                
                <div>
                    <h2 id="balanceTitle" class="text-[10px] uppercase tracking-[0.4em] text-[#D4AF37] mb-4 font-bold opacity-70">Réserve du Coffre</h2>
                    <div class="flex items-baseline gap-4 mb-10">
                        <span id="balanceDisplay" class="text-7xl font-bold text-white tracking-tighter">0.00</span>
                        <span class="text-xl text-[#D4AF37] font-luxury">ARCANA</span>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between text-[10px] mb-3 uppercase tracking-widest opacity-50 font-bold">
                                <span>Objectif : 100,000 $</span>
                                <span id="progressText">Récolté : 2,500 $</span>
                            </div>
                            <div class="progress-track">
                                <div id="progressBar" class="progress-glow"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white/5 p-8 rounded-[32px] border border-white/10 space-y-6">
                    <div class="space-y-2">
                        <label class="text-[10px] uppercase tracking-widest opacity-40">Devise d'investissement (Polygon Network)</label>
                        <select id="tokenSelect" class="w-full rounded-2xl p-4 text-sm focus:outline-none">
                            <option value="POL">Polygon (POL)</option>
                            <option value="USDT">Tether (USDT)</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] uppercase tracking-widest opacity-40">Montant</label>
                        <input type="number" id="amountInput" placeholder="0.00" class="w-full rounded-2xl p-4 text-2xl font-semibold focus:outline-none">
                    </div>

                    <div id="receiveText" class="text-center text-[10px] text-[#00ffcc] font-bold tracking-widest uppercase py-2">
                        Tu recevras : 0 ARCANA
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4">
                        <button id="buyBtn" class="btn-premium flex-1 py-5 rounded-2xl text-sm shadow-2xl">Acheter</button>
                        <a href="whitepaper.pdf" target="_blank" class="flex-1 py-5 rounded-2xl text-[10px] font-bold tracking-[0.2em] border-2 border-[#D4AF37] text-white hover:bg-[#D4AF37]/10 flex items-center justify-center">
                            WHITE PAPER
                        </a>
                    </div>
                </div>
            </div>
        </div>

        </main>

    <div id="quickPouch" class="fixed bottom-6 right-6 z-[100] max-w-[320px]">
        <div class="glass-card p-5 border-[#D4AF37]/40 shadow-[0_0_30px_rgba(212,175,55,0.2)] space-y-4">
            <div class="text-center">
                <div class="text-[10px] uppercase tracking-widest font-bold text-[#D4AF37]">Ma Réserve Arcana</div>
                <div id="pouchBalance" class="text-2xl font-bold text-white mt-1">0 ARCANA</div>
                <div class="flex items-center justify-center gap-2 mt-2">
                    <span class="w-2 h-2 bg-[#00ffcc] rounded-full animate-pulse"></span>
                    <span class="text-[8px] text-[#00ffcc] font-bold">POLYGON</span>
                </div>
            </div>
            <div class="border-t border-[#D4AF37]/20 pt-4">
                <div class="text-[10px] uppercase tracking-widest font-bold text-[#D4AF37] mb-3">Guide de Poche</div>
                <div class="space-y-2 text-left">
                    <div class="flex items-start gap-2">
                        <span class="text-[#D4AF37] font-luxury text-sm">01</span>
                        <p class="text-xs text-[#F7E7CE]/80">Connecter Trust Wallet ou MetaMask.</p>
                    </div>
                    <div class="flex items-start gap-2">
                        <span class="text-[#D4AF37] font-luxury text-sm">02</span>
                        <p class="text-xs text-[#F7E7CE]/80">Échanger POL contre ARCANA.</p>
                    </div>
                    <div class="flex items-start gap-2">
                        <span class="text-[#D4AF37] font-luxury text-sm">03</span>
                        <p class="text-xs text-[#F7E7CE]/80">Jetons sécurisés dans le coffre.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const { default: Onboard } = await import('https://esm.sh/@web3-onboard/core@2');
        const { default: injectedModule } = await import('https://esm.sh/@web3-onboard/injected-wallets@2');

        const ONBOARD_PROJECT_ID = "YOUR_PROJECT_ID";
        const onboard = Onboard({
            wallets: [injectedModule()],
            chains: [{ id: "0x89", token: "POL", label: "Polygon Mainnet", rpcUrl: "https://polygon-rpc.com" }],
            appMetadata: { name: "Arcana Safe", icon: "logo.png", description: "DeFi Sanctuary" },
            accountCenter: { desktop: { enabled: true }, mobile: { enabled: true } }
        });

        const PRESALE_VAULT = "0x1990fd46a1ad0344751be45d6779b8c1f827076d";
        const abiSimple = ["function balanceOf(address owner) view returns (uint256)", "function buyWithPOL() payable"];
        let userAddress = null;
        let connectedSigner = null;

        async function updateUI() {
            if (userAddress && connectedSigner) {
                try {
                    const provider = connectedSigner.provider || (connectedSigner && new ethers.providers.Web3Provider(window.ethereum));
                    const contract = new ethers.Contract(PRESALE_VAULT, abiSimple, provider);
                    const balance = await contract.balanceOf(userAddress);
                    const formatted = parseFloat(ethers.utils.formatUnits(balance, 18)).toLocaleString('fr-FR');
                    document.getElementById('balanceDisplay').innerText = formatted;
                    document.getElementById('pouchBalance').innerText = formatted + " ARCANA";
                    document.getElementById('quickPouch').style.display = "block";
                    document.getElementById('balanceTitle').innerText = "VOTRE RÉSERVE PRIVÉE";
                } catch (e) { console.error("Update UI:", e); }
            }
        }

        async function connect() {
            const wallets = await onboard.connectWallet();
            if (wallets && wallets.length > 0 && wallets[0].provider) {
                const provider = new ethers.providers.Web3Provider(wallets[0].provider, "any");
                connectedSigner = provider.getSigner();
                userAddress = await connectedSigner.getAddress();
                const btn = document.getElementById('connectBtn');
                if (btn) { btn.innerText = userAddress.substring(0, 6) + "..." + userAddress.substring(38); btn.classList.add('bg-[#D4AF37]', 'text-black'); }
                updateUI();
            }
        }

        async function buyNow() {
            if (!userAddress) { await connect(); if (!connectedSigner) return; }
            const amount = document.getElementById('amountInput').value;
            if (!amount || amount <= 0) return alert("Veuillez entrer un montant.");
            try {
                document.getElementById('buyBtn').innerText = "Vérification...";
                const contract = new ethers.Contract(PRESALE_VAULT, abiSimple, connectedSigner);
                const tx = await contract.buyWithPOL({ value: ethers.utils.parseEther(amount.toString()) });
                await tx.wait();
                document.getElementById('successSound').play();
                alert("Félicitations ! Vos ARCANA ont été sécurisés.");
                updateUI();
            } catch (e) { console.error(e); alert("Transaction annulée."); }
            finally { document.getElementById('buyBtn').innerText = "Acheter"; }
        }

        function calculateReceive() {
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            document.getElementById('receiveText').innerText = "Tu recevras : " + Math.floor(amount * 4000).toLocaleString('fr-FR') + " ARCANA";
        }

        document.getElementById('buyBtn').onclick = buyNow;
        document.getElementById('amountInput').oninput = calculateReceive;
        document.getElementById('connectBtn').onclick = connect;
    </script>
</body>
</html>